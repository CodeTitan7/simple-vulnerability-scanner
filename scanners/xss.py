import requests
from bs4 import BeautifulSoup
import logging
from config import XSS_PAYLOADS

def scan_xss(url):
    try:
        response = requests.get(url)
        soup = BeautifulSoup(response.content, "html.parser")
        forms = soup.find_all("form")
        for form in forms:
            form_action = form.get("action")
            form_url = url + form_action if form_action else url
            form_method = form.get("method", "get").lower()
            for payload in XSS_PAYLOADS:
                if form_method == "get":
                    response = requests.get(form_url, params={"input": payload})
                else:
                    response = requests.post(form_url, data={"input": payload})
                if payload in response.text:
                    print(f"XSS vulnerability found in form at {form_url} with payload: {payload}")
                    logging.info(f"XSS vulnerability found in form at {form_url} with payload: {payload}")
                    return True
    except requests.RequestException as e:
        logging.error(f"[ERROR] Failed to request URL {url}: {e}")
    return False